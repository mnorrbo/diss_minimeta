pbound_table <- pbound_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no")) %>%
filter(study == 1) %>%
group_by(id, significant) %>%
count() %>%
ungroup()
pbound_table
pbound_table <- pbound_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no")) %>%
filter(study == 1)
View(pbound_table)
pbound_table <- pbound_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no")) %>%
filter(study == 1)
pbound_table <- pbound_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no")) %>%
filter(id == 1)
pbound_table <- pbound_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no")) %>%
filter(id == 1, study == 1) %>%
group_by(id, significant) %>%
count() %>%
ungroup()
pbound_table
load("pbound_tmp.RData")
load("metahack_tmp.RData")
# p-threshold table
pbound_table <- pbound_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no")) %>%
group_by(id, significant) %>%
count() %>%
ungroup() %>%
mutate(id = ifelse(is.na(id), "meta", id)) %>%
mutate(id = recode(id, `0` = "filedrawer", `1` = "studies")) %>%
mutate(proportion = round(n/nrow(pbound_tmp),2))
write.table(pbound_table, file = "pbound_table.csv", sep = ",", row.names = FALSE)
pbound_table %>%
kable()
# meta-hack table
metahack_table <- metahack_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no")) %>%
group_by(id, significant) %>%
count() %>%
ungroup() %>%
mutate(id = ifelse(is.na(id), "meta", id)) %>%
mutate(id = recode(id, `0` = "filedrawer", `1` = "studies")) %>%
mutate(proportion = round(n/nrow(metahack_tmp),2))
write.table(metahack_table, file = "metahack_table.csv", sep = ",", row.names = FALSE)
metahack_table %>%
kable()
load("metahack_dat.RData")
load("pbound_dat.RData")
# FPR in Sim 2
pbound_fpr_range <- pbound_dat %>%
summarise(maxfpr = max(power),
minfpr = min(power))
metahack_fpr_range <- metahack_dat %>%
summarise(maxfpr = max(power),
minfpr = min(power))
# false positive rate of mini meta across parameters
metahack_fpr <- metahack_table[[5,3]]/sum(metahack_table$n[4:5])
# false positive rate of mini meta across parameters
pbound_fpr <- pbound_table[[5,3]]/sum(pbound_table$n[4:5])
?rm
??keyring
library(keyring)
library(RPostgreSQL)
?aov
knitr::opts_chunk$set(echo = TRUE)
load("pbound_tmp.RData")
load("metahack_tmp.RData")
pbound_table <- pbound_tmp %>%
mutate(significant = ifelse(p < 0.05, "yes", "no"))
library(tidyverse)
library(metafor)
library(colorspace)
library(knitr)
View(pbound_tmp)
pbound_table <- pbound_tmp %>%
filter(id = 1)
# p-threshold table
pbound_table <- pbound_tmp %>%
filter(id == 1)
# p-threshold table
pbound_table <- pbound_tmp %>%
filter(id == 1) %>%
count()
View(pbound_tmp)
View(pbound_table)
total_simulations <- pbound_tmp %>%
filter(study == 1)
View(total_simulations)
met_bound_no <- pbound_tmp %>%
filter(id == 1) %>%
count()
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
count()
pbound_tmp %>%
filter(study == 0)
pbound_tmp %>%
filter(study == 0, p < 0.05)
View(total_simulations)
# p-threshold table results
options(scipen = 99)
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
count()
View(total_simulations)
met_bound_no <- pbound_tmp %>%
filter(id == 1) %>%
count()
did_not_meet <- pbound_tmp %>%
filter(id == 1) %>%
count()
View(pbound_tmp)
View(did_not_meet)
View(did_not_meet)
did_not_meet <- pbound_tmp %>%
filter(id == 1)
View(did_not_meet)
View(pbound_tmp)
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
count()
View(did_not_meet)
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last)
count()
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count()
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count()
pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last)
count()
pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count()
sig_meta <- pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()
View(sig_meta)
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count()
sig_meta <- pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()
not_sig_meta <- pbound_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()
View(not_sig_meta)
pbound_table <- inner_join(total_simulations, did_not_meet)
View(pbound_table)
pbound_table <- inner_join(total_simulations, did_not_meet)
pbound_table <- left_join(total_simulations, did_not_meet)
View(pbound_table)
pbound_table <- full_join(total_simulations, did_not_meet)
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
sig_meta <- pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()
not_sig_meta <- pbound_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()
View(total_simulations)
View(did_not_meet)
View(sig_meta)
View(not_sig_meta)
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
sig_meta <- pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
not_sig_meta <- pbound_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
View(sig_meta)
did_not_meet$n/total_simulations$n
pbound_table <- tibble(dumb = did_not_meet$n/total_simulations$n)
View(pbound_table)
pbound_table <- tibble(dumb = did_not_meet$n/total_simulations$n,
dumber = sig_meta$n/total_simulations$n,
dumbest = not_sig_meta$n/total_simulations$n)
View(pbound_tmp)
View(pbound_tmp)
View(pbound_table)
pbound_table <- tibble(total_simulations[,1:2],
dumb = did_not_meet$n/total_simulations$n,
dumber = sig_meta$n/total_simulations$n,
dumbest = not_sig_meta$n/total_simulations$n)
pbound_table <- t(tibble(total_simulations[,1:2],
dumb = did_not_meet$n/total_simulations$n,
dumber = sig_meta$n/total_simulations$n,
dumbest = not_sig_meta$n/total_simulations$n))
pbound_table <- t(tibble(total_simulations[,1:2],
dumb = did_not_meet$n/total_simulations$n,
dumber = sig_meta$n/total_simulations$n,
dumbest = not_sig_meta$n/total_simulations$n)) %>%
kable()
?t
pbound_table <- round(t(tibble(total_simulations[,1:2],
dumb = did_not_meet$n/total_simulations$n,
dumber = sig_meta$n/total_simulations$n,
dumbest = not_sig_meta$n/total_simulations$n))) %>%
kable()
pbound_table <- t(tibble(total_simulations[,1:2],
dumb = round(did_not_meet$n/total_simulations$n),
dumber = round(sig_meta$n/total_simulations$n),
dumbest = round(not_sig_meta$n/total_simulations$n))) %>%
kable()
pbound_table <- t(tibble(total_simulations[,1:2],
dumb = round(did_not_meet$n/total_simulations$n, 2),
dumber = round(sig_meta$n/total_simulations$n, 2),
dumbest = round(not_sig_meta$n/total_simulations$n, 2)))
total_simulations <- metahack_tmp %>%
filter(study == 1) %>%
group_by(pmax.first) %>%
count() %>%
ungroup()
did_not_meet <- metahack_tmp %>%
filter(id == 0) %>%
group_by(pmax.first) %>%
count() %>%
ungroup()
sig_meta <- metahack_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first) %>%
count()  %>%
ungroup()
not_sig_meta <- metahack_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first) %>%
count()  %>%
ungroup()
metahack_table <- t(tibble(total_simulations[,1],
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
dumber = round(sig_meta$n/total_simulations$n, 2),
dumbest = round(not_sig_meta$n/total_simulations$n, 2)))
View(metahack_table)
View(total_simulations)
pbound_table <- t(tibble(total_simulations[,1:2],
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
sigmeta = round(sig_meta$n/total_simulations$n, 2),
nonsigmeta = round(not_sig_meta$n/total_simulations$n, 2)))
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
sig_meta <- pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
not_sig_meta <- pbound_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
pbound_table <- t(tibble(total_simulations[,1:2],
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
sigmeta = round(sig_meta$n/total_simulations$n, 2),
nonsigmeta = round(not_sig_meta$n/total_simulations$n, 2)))
View(pbound_table)
total_simulations <- metahack_tmp %>%
filter(study == 1) %>%
group_by(pmax.first) %>%
count() %>%
ungroup()
did_not_meet <- metahack_tmp %>%
filter(id == 0) %>%
group_by(pmax.first) %>%
count() %>%
ungroup()
sig_meta <- metahack_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first) %>%
count()  %>%
ungroup()
not_sig_meta <- metahack_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first) %>%
count()  %>%
ungroup()
metahack_table <- t(tibble(total_simulations[,1],
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
dumber = round(sig_meta$n/total_simulations$n, 2),
dumbest = round(not_sig_meta$n/total_simulations$n, 2)))
metahack_table <- t(
tibble(
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
sigmeta = round(sig_meta$n/total_simulations$n, 2),
notsigmeta = round(not_sig_meta$n/total_simulations$n, 2)
)
)
total_simulations <- metahack_tmp %>%
filter(study == 1) %>%
count() %>%
ungroup()
did_not_meet <- metahack_tmp %>%
filter(id == 0) %>%
count() %>%
ungroup()
sig_meta <- metahack_tmp %>%
filter(study == 0, p < 0.05) %>%
count()  %>%
ungroup()
not_sig_meta <- metahack_tmp %>%
filter(study == 0, p > 0.05) %>%
count()  %>%
ungroup()
metahack_table <- t(
tibble(
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
sigmeta = round(sig_meta$n/total_simulations$n, 2),
notsigmeta = round(not_sig_meta$n/total_simulations$n, 2)
)
)
total_simulations <- metahack_tmp %>%
filter(study == 1) %>%
count()
did_not_meet <- metahack_tmp %>%
filter(id == 0) %>%
count()
sig_meta <- metahack_tmp %>%
filter(study == 0, p < 0.05) %>%
count()
not_sig_meta <- metahack_tmp %>%
filter(study == 0, p > 0.05) %>%
count()
metahack_table <- t(
tibble(
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
sigmeta = round(sig_meta$n/total_simulations$n, 2),
notsigmeta = round(not_sig_meta$n/total_simulations$n, 2)
)
)
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
sig_meta <- pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
not_sig_meta <- pbound_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
pbound_table <- t(tibble(total_simulations[,1:2],
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
did_not_meet <- pbound_tmp %>%
total_simulations <- pbound_tmp %>%
filter(study == 1) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
did_not_meet <- pbound_tmp %>%
filter(id == 0) %>%
group_by(pmax.first, pmax.last) %>%
count() %>%
ungroup()
sig_meta <- pbound_tmp %>%
filter(study == 0, p < 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
not_sig_meta <- pbound_tmp %>%
filter(study == 0, p > 0.05) %>%
group_by(pmax.first, pmax.last) %>%
count()  %>%
ungroup()
pbound_table <- t(tibble(total_simulations[,1:2],
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
sigmeta = round(sig_meta$n/total_simulations$n, 2),
nonsigmeta = round(not_sig_meta$n/total_simulations$n, 2)))
View(pbound_table)
View(did_not_meet)
View(total_simulations)
View(sig_meta)
View(not_sig_meta)
total_simulations <- metahack_tmp %>%
filter(study == 1) %>%
count()
did_not_meet <- metahack_tmp %>%
filter(id == 0) %>%
count()
sig_meta <- metahack_tmp %>%
filter(study == 0, p < 0.05) %>%
count()
not_sig_meta <- metahack_tmp %>%
filter(study == 0, p > 0.05) %>%
count()
View(total_simulations)
# simulation parameters
params <- crossing(
i = 1:10000, # iterations
n.studies = c(4,8), # max no. of studies
d = 0, # true effect size
n = seq(50, 250, 50), # vector of sample sizes
pmax.first = 0.05, # first p-value threshold
minitarget = 0.05, # minimeta threshold
method = c("HE", "FE") # random (HE) and fixed effect (FE)
)
View(total_simulations)
View(sig_meta)
View(did_not_meet)
View(metahack_tmp)
View(metahack_tmp)
metahack_table <- t(
tibble(
didnotmeet = round(did_not_meet$n/total_simulations$n, 2),
sigmeta = round(sig_meta$n/total_simulations$n, 2),
notsigmeta = round(not_sig_meta$n/total_simulations$n, 2)
)
)
View(metahack_tmp)
View(metahack_table)
keyring_unlock("remote")
library(keyring)
library(RPostgreSQL)
keyring_unlock("remote")
username <- key_get("wrestling_postgresql_username", keyring = "remote")
password <- key_get("wrestling_postgresql_password", keyring = "remote")
username <- key_get("wrestling_postgresql_username", keyring = "remote")
password <- key_get("wrestling_postgresql_password", keyring = "remote")
keyring_lock("remote")
db_connect_remote <- dbConnect(drv = PostgreSQL(max.con = 2), user = username, password = password, dbname='mvhbdgdk', host='34.245.37.126')
rm(username, password)
dbGetQuery(db_connect_remote, "SELECT * FROM wrestlers")
wrestlers <- dbGetQuery(db_connect_remote, "SELECT * FROM wrestlers")
View(wrestlers)
dbDisconnect(db_connect_remote)
dbDisconnect(db_connect_remote)
